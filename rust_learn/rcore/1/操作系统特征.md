操作系统的面向：一是向下管理并控制计算机硬件和各种外设，二是向上管理应用软件并提供各种服务

书重点讲述的对象是操作系统内核，它的主要组成部分包括：
1. 进程/线程管理：内核负责管理系统中的进程或线程，创建、销毁、调度和切换进程或线程。
2. 内存管理：内核负责管理系统的内存，分配和回收内存空间，并保证进程之间的内存隔离。
3. 文件系统：内核提供文件系统接口，负责管理存储设备上的文件和目录，并允许应用访问文件系统。
4. 网络通信：内核提供网络通信接口，负责管理网络连接并允许应用进行网络通信。
5. 设备驱动：内核提供设备驱动接口，负责管理硬件设备并允许应用和内核其他部分访问设备。
6. 同步互斥：内核负责协调多个进程或线程之间对共享资源的访问。同步功能主要用于解决进程或线程
之间的协作问题，互斥功能主要用于解决进程或线程之间的竞争问题。
7. 系统调用接口：内核提供给应用程序访问系统服务的入口，应用程序通过系统调用接口调用操作系统
提供的服务，如文件系统、网络通信、进程管理等。


操作系统与运行在用户态软件之间的接口
形式就是上一节提到的应用程序二进制接口 (ABI, Application Binary Interface)。
操作系统不能只提供面向单一编程语言的函数库的编程接口 (API, Application Programming Interface) ，它的
接口需要考虑对基于各种编程语言的应用支持，以及访问安全等因素，使得应用软件不能像访问函数库一样
的直接访问操作系统内部函数，更不能直接读写操作系统内部的地址空间


 Linux 有超过三百个的系统调用接口。下面列出
了一些相对比较重要的操作系统接口或抽象，以及它们的大致功能：
• 进程（即程序运行过程）管理：复制创建进程 fork 、退出进程 exit 、执行进程 exec 等。
• 线程管理：线程（即程序的一个执行流）的创建、执行、调度切换等。
• 线程同步互斥的并发控制：互斥锁 mutex 、信号量 semaphore 、管程 monitor 、条件变量 condition variable
等。
• 进程间通信：管道 pipe 、信号 signal 、事件 event 等。
• 虚存管理：内存空间映射 mmap 、改变数据段地址空间大小 sbrk 、共享内存 shm 等。
• 文件 I/O 操作：对存储设备中的文件进行读 read 、写 write 、打开 open 、关闭 close 等操作。
• 外设 I/O 操作：外设包括键盘、显示器、串口、磁盘、时钟…，主要采用文件 I/O 操作接口。


各种应用程序在执行环境中执行其功能，而具体如何执行，取决于 程序的控制流

异常控制流是处理器在执行过程中的突变，其主要作用是通过硬件和操作系统的协同工作来响应
处理器状态中的特殊变化。

我们把控制流在执行完某指令时的物理资源内容，即确保下一时刻能继续 正确执行控制流指令的物理
资源内容称为控制流的 上下文 (Context) ，也可称为控制流所在执行环境的状态。

在操作系统中，需要处理三类异常控制流：外设中断 (Device Interrupt) 、陷入 (Trap) 和异常 (Exception，也称
Fault Interrupt)。


外设 中断 (Interrupt) 是指由外部设备引起的外部 I/O 事件，如时钟中断、控制台中断等。外设中断是异步产
生的，与处理器的执行无关。产生中断后，操作系统需要进行中断处理来响应中断请求，这会破坏被打断前
应用程序的控制流上下文，所以操作系统要保存与恢复被打断前应用程序的控制流上下文。

异常 (Exception) 是在处理器执行指令期间检测到不正常的或非法的内部事件（如 x86 平台上的除零错、地址
访问越界）。产生异常后，操作系统需要进行异常处理，这会破坏被打断前应用程序的控制流上下文，所以
操作系统要保存与恢复被打断前应用程序的控制流上下文。

陷入 (Trap) 是程序在执行过程中由于要通过系统调用请求操作系统服务而有意引发的事件。产生陷入后，操
作系统需要执行系统调用服务来响应系统调用请求，这会破坏陷入前应用程序的控制流上下文，所以操作系
统要保存与恢复陷入前应用程序的控制流上下文。



站在应用程序自身的角度来看，进程 (Process) 的一个经典定义是一个正在运行的程序实例。当程序运行在操
作系统中的时候，从程序的视角来看，它会产生一种“幻觉”：即该程序是整个计算机系统中当前运行的唯
一的程序，能够独占使用处理器、内存和外设，而且程序中的代码和数据是系统内存中唯一的对象


地址空间 (Address Space) 是对物理内存的虚拟化和抽象，也称虚存 (Virtual Memory)。

操作系统中的虚存管理与处理器的 MMU 密切相关, 在启动虚存机制
后，软件通过 CPU 访问的每个虚拟地址都需要通过 CPU 中的 MMU 转换为一个物理地址来进行访问

文件 (File) 主要用于对持久存储的抽象，并进一步扩展到为外设的抽象。具体而言，文件可理解为存放在持
久存储介质（比如硬盘、光盘、U 盘等）上，方便应用程序和用户读写的数据

基于操作系统的四个抽象，我们可以看出，从总体上看，操作系统具有五个方面的特征：虚拟化 (Virtualization)、
并发性 (Concurrency)、异步性、共享性和持久性 (Persistency)。

内存虚拟化其实是一种 “空间虚拟化”，可进一步细分为 内存地址虚拟化和 内存大小虚拟化。这里的每个
符号在运行时是要对应到具体的内存地址的。这些内存地址的具体数值是什么？程序员不用关心。为什么？
因为编译器会自动帮我们把这些符号翻译成地址，形成可执行程序。程序使用的内存是否占得太大了？在一
般情况下，程序员也不用关心。

再来看 CPU 虚拟化。不同的应用程序可以在内存中并发运行，相同的应用程序也可有多个拷贝在内存中并
发运行。而每个程序都“认为”自己完全独占了 CPU 在运行，这是 “CPU 虚拟化”，也是一种 “时间虚拟
化”。

操作系统为了能够让 CPU 充分地忙起来，并充分利用各种资源，就需要有多种不同的应用程序在执行。这
些应用程序是分时执行的，并由操作系统来完成各个应用在运行时的任务切换。

在这里，异步是指由于操作系统的调度和中断等，会不时地暂停或打断当前正在运行的程序，使得程序的整
个运行过程走走停停。在应用程序运行的表现上，特别体现在它的执行完成时间是不可预测的。但需要注意，
只要应用程序的输入是一致的，那么它的输出结果应该是符合预期的

共享是指多个应用并发运行时，宏观上体现出它们可同时访问同一个资源，即这个资源可被共享。但其实在
微观上，操作系统在硬件等的支持下要确保应用程序互斥访问这个共享的资源。比如，在单核处理器下，对
于两个应用同时访问同一个内存单元的情况，从宏观的应用层面上看，二者都能正确地读出同一个内存单元
的内容；而在微观上，操作系统会调度应用程序的先后执行顺序，确保在任何一个时刻，只有一个应用去访
问存储单元。在多核处理器下，多个 CPU 核可能同时访问同一内存单元，在这种多核场景下的共享性不仅
仅由 OS 来保证，还需硬件级的 Cache 一致性保证。

操作系统提供了文件系统来从可持久保存的存储介质（磁盘，SSD 等，以后以硬盘来代表）中取数据和代码
到内存中，并可以把内存中的数据写回到硬盘上。硬盘在这里是外设，具有持久性，以文件系统的形式呈现
给应用程序。

什么是操作系统？操作系统的主要目标是什么？
2. * 面向服务器的操作系统与面向手机的操作系统在功能上有何异同？
3. * 对于目前的手机或桌面操作系统而言，操作系统是否应该包括网络浏览器？请说明理由。
4. * 操作系统的核心抽象有哪些？它们应对的对象是啥？
5. * 操作系统与应用程序之间通过什么来进行互操作和数据交换？

操作系统的特征是什么？请结合你日常使用的操作系统的具体运行情况来进一步说明操作系统的特
征。
7. * 请说明基于 C 语言应用的执行环境与基于 Java 语言应用的执行环境的异同。
8. ** 请简要列举操作系统的系统调用的作用，以及简要说明与程序执行、内存分配、文件读写相关的
Linux 系统调用的大致接口和含义。
9. ** 以你编写的可以睡眠 5 秒后打印出一个字符串的应用程序 A 为例，说明什么是控制流？什么是异常
控制流？什么是进程、地址空间和文件？并简要描述操作系统是如何支持这个应用程序完成其工作并
结束的。
10. * 请简要描述支持单个应用的 OS、批处理 OS、多道程序 OS、分时共享 OS 的特点。